<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Recommender</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #3455e4 0%, #66a1ef 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        h1 {
            font-family: Arial;
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        #searchInput {
            flex: 1;
            padding: 15px 20px;
            font-size: 1.1em;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            outline: none;
            transition: border-color 0.3s;
        }

        #searchInput:focus {
            border-color: #66a1ef;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .search-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .movie-card {
            background: #f9f9f9;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .movie-card img {
            width: 100%;
            height: 225px;
            object-fit: cover;
        }

        .movie-card-info {
            padding: 10px;
        }

        .movie-title {
            font-size: 0.9em;
            font-weight: bold;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .movie-year {
            font-size: 0.85em;
            color: #666;
        }

        .selected-movie {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: none;
        }

        .selected-movie.active {
            display: block;
        }

        .movie-header {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }

        .movie-poster {
            flex-shrink: 0;
        }

        .movie-poster img {
            width: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .movie-details {
            flex: 1;
        }

        .movie-details h2 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #333;
        }

        .movie-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .rating {
            color: #f39c12;
            font-weight: bold;
        }

        .overview {
            line-height: 1.6;
            color: #555;
            margin-bottom: 15px;
        }

        .genre-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .tag {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .recommendations-section h3 {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #333;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 25px;
        }

        .recommendation-card {
            background: #f9f9f9;
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .recommendation-card img {
            width: 100%;
            height: 270px;
            object-fit: cover;
        }

        .recommendation-info {
            padding: 15px;
        }

        .recommendation-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 1em;
        }

        .recommendation-rating {
            color: #f39c12;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #666;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .placeholder-img {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Movie Recommender</h1>
            <p class="subtitle">Discover your next favorite movie</p>
        </header>

        <div class="search-section">
            <div class="search-box">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Search for a movie (e.g., Avatar, Inception, The Dark Knight)..."
                    autocomplete="on"
                >
                <button class="btn btn-primary" onclick="searchMovies()">Search</button>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>

        <div id="selectedMovie" class="selected-movie">
            <div class="movie-header">
                <div class="movie-poster">
                    <img id="selectedPoster" src="" alt="Movie Poster">
                </div>
                <div class="movie-details">
                    <h2 id="selectedTitle"></h2>
                    <div class="movie-meta">
                        <span id="selectedYear"></span>
                        <span class="rating">‚≠ê <span id="selectedRating"></span></span>
                    </div>
                    <p class="overview" id="selectedOverview"></p>
                    <div><strong>Director:</strong> <span id="selectedDirector"></span></div>
                    <div class="genre-tags" id="selectedGenres"></div>
                </div>
            </div>

            <div class="recommendations-section">
                <h3>Recommended Movies</h3>
                <div id="recommendations" class="recommendations-grid"></div>
            </div>
        </div>
    </div>

    <script>
        // Search for movies
        async function searchMovies() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '<div class="loading">Searching...</div>';

            try {
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query })
                });

                const data = await response.json();

                if (data.error) {
                    resultsDiv.innerHTML = `<div class="error">${data.error}</div>`;
                    return;
                }

                if (data.results.length === 0) {
                    resultsDiv.innerHTML = '<div class="loading">No movies found. Try another search.</div>';
                    return;
                }

                resultsDiv.innerHTML = data.results.map(movie => `
                    <div class="movie-card" onclick="getRecommendations(${movie.index})">
                        ${movie.poster ? 
                            `<img src="${movie.poster}" alt="${movie.title}">` :
                            `<div class="placeholder-img" style="height: 225px;">üé¨</div>`
                        }
                        <div class="movie-card-info">
                            <div class="movie-title">${movie.title}</div>
                            <div class="movie-year">${movie.year || 'N/A'}</div>
                        </div>
                    </div>
                `).join('');

            } catch 
            (error) { 
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Get recommendations for selected movie
        async function getRecommendations(movieIndex) {
            const selectedDiv = document.getElementById('selectedMovie');
            const recommendationsDiv = document.getElementById('recommendations');
            
            selectedDiv.classList.add('active');
            recommendationsDiv.innerHTML = '<div class="loading">Loading recommendations...</div>';
            
            // Scroll to selected movie
            selectedDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });

            try {
                const response = await fetch('/api/recommend', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ movie_index: movieIndex })
                });

                const data = await response.json();

                if (data.error) {
                    recommendationsDiv.innerHTML = `<div class="error">${data.error}</div>`;
                    return;
                }

                const movie = data.selected_movie;
                
                // Update selected movie details
                document.getElementById('selectedTitle').textContent = movie.title;
                document.getElementById('selectedYear').textContent = movie.year || 'N/A';
                document.getElementById('selectedRating').textContent = movie.rating.toFixed(1);
                document.getElementById('selectedOverview').textContent = movie.overview || 'No overview available.';
                document.getElementById('selectedDirector').textContent = movie.director || 'Unknown';
                
                if (movie.poster) {
                    document.getElementById('selectedPoster').src = movie.poster;
                } 
                else {
                    document.getElementById('selectedPoster').src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="450"><rect width="300" height="450" fill="%23667eea"/><text x="50%" y="50%" text-anchor="middle" fill="white" font-size="48">üé¨</text></svg>';
                }

                // Display genre tags
                const genresDiv = document.getElementById('selectedGenres');
                if (movie.genres) {
                    const genres = movie.genres.split(' ').filter(g => g);
                    genresDiv.innerHTML = genres.slice(0, 5).map(genre => 
                        `<span class="tag">${genre}</span>`
                    ).join('');
                }

                // Display recommendations
                recommendationsDiv.innerHTML = data.recommendations.map(rec => `
                    <div class="recommendation-card">
                        ${rec.poster ? 
                            `<img src="${rec.poster}" alt="${rec.title}">` :
                            `<div class="placeholder-img" style="height: 270px;">üé¨</div>`
                        }
                        <div class="recommendation-info">
                            <div class="recommendation-title">${rec.title}</div>
                            <div class="recommendation-rating">‚≠ê ${rec.rating.toFixed(1)}</div>
                            <div style="font-size: 0.85em; color: #888; margin-top: 5px;">
                                ${rec.year || 'N/A'} ‚Ä¢ ${(rec.similarity * 100).toFixed(0)}% match
                            </div>
                        </div>
                    </div>
                `).join('');

            } 
            catch (error) {
                recommendationsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Allow Enter key to search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchMovies();
            }
        });
    </script>
</body>
</html>